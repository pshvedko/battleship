<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="css/style.css">
    <title>BattleShip</title>
</head>
<body>

<script lang="javascript">

    const field = [];
    const clazz = {0: "free", 1: "boat", 2: "lose", 3: "boom"}

    function initField() {
        for (let f = 0; f < 2; f++) {
            field[f] = []
            for (let i = 0; i < 10; i++) {
                field[f][i] = []
                for (let j = 0; j < 10; j++) {
                    let e = document.getElementById(f + '.' + i + '.' + j)
                    if (f === 1) {
                        e.className = "void"
                        e.onclick = function () {
                            onClick(f, i, j)
                        }
                    }
                    field[f][i][j] = e
                }
            }
        }
    }

    let seq = 0
    let socket = new WebSocket(location.origin.replace(/^http/, 'ws'))
    let handle = new Map

    function query(done, id, method, path, body) {
        socket.send([id.toString(), method, path, JSON.stringify(body)].join('\r\n'))
        handle.set(id.toString(), done)
    }

    function reply(p) {
        if (!handle.has(p[0]))
            return
        if (p[1] === '200')
            try {
                handle.get(p[0])(JSON.parse(p[3]))
            } catch (e) {
            }
        if (p[2] === '#')
            handle.delete(p[0])
    }

    function onClick(f, x, y) {
        query(onReply, seq++, "GET", "/click", {X: x, Y: y})
    }

    function onReply(e = {
        F: 0,
        X: 0,
        Y: 0,
        C: 0,
    }) {
        field[e.F][e.X][e.Y].className = clazz[e.C]
        field[e.F][e.X][e.Y].onclick = undefined
    }

    socket.onopen = function () {
        query(onReply, seq++, "GET", "/begin")
    }

    socket.onmessage = function (e) {
        reply(e.data.toString().split(/\r?\n/))
    }

    socket.onclose = function () {
        handle.clear()
    }

    socket.onerror = function () {
        handle.clear()
    }

    window.onload = function () {
        initField()
    }

</script>

<div class="app">
    <div class="field">
        <table>
            <tr>
                <td id="0.0.0">&#x25CF;</td>
                <td id="0.0.1">&#x25CF;</td>
                <td id="0.0.2">&#x25CF;</td>
                <td id="0.0.3">&#x25CF;</td>
                <td id="0.0.4">&#x25CF;</td>
                <td id="0.0.5">&#x25CF;</td>
                <td id="0.0.6">&#x25CF;</td>
                <td id="0.0.7">&#x25CF;</td>
                <td id="0.0.8">&#x25CF;</td>
                <td id="0.0.9">&#x25CF;</td>
            </tr>
            <tr>
                <td id="0.1.0">&#x25CF;</td>
                <td id="0.1.1">&#x25CF;</td>
                <td id="0.1.2">&#x25CF;</td>
                <td id="0.1.3">&#x25CF;</td>
                <td id="0.1.4">&#x25CF;</td>
                <td id="0.1.5">&#x25CF;</td>
                <td id="0.1.6">&#x25CF;</td>
                <td id="0.1.7">&#x25CF;</td>
                <td id="0.1.8">&#x25CF;</td>
                <td id="0.1.9">&#x25CF;</td>
            </tr>
            <tr>
                <td id="0.2.0">&#x25CF;</td>
                <td id="0.2.1">&#x25CF;</td>
                <td id="0.2.2">&#x25CF;</td>
                <td id="0.2.3">&#x25CF;</td>
                <td id="0.2.4">&#x25CF;</td>
                <td id="0.2.5">&#x25CF;</td>
                <td id="0.2.6">&#x25CF;</td>
                <td id="0.2.7">&#x25CF;</td>
                <td id="0.2.8">&#x25CF;</td>
                <td id="0.2.9">&#x25CF;</td>
            </tr>
            <tr>
                <td id="0.3.0">&#x25CF;</td>
                <td id="0.3.1">&#x25CF;</td>
                <td id="0.3.2">&#x25CF;</td>
                <td id="0.3.3">&#x25CF;</td>
                <td id="0.3.4">&#x25CF;</td>
                <td id="0.3.5">&#x25CF;</td>
                <td id="0.3.6">&#x25CF;</td>
                <td id="0.3.7">&#x25CF;</td>
                <td id="0.3.8">&#x25CF;</td>
                <td id="0.3.9">&#x25CF;</td>
            </tr>
            <tr>
                <td id="0.4.0">&#x25CF;</td>
                <td id="0.4.1">&#x25CF;</td>
                <td id="0.4.2">&#x25CF;</td>
                <td id="0.4.3">&#x25CF;</td>
                <td id="0.4.4">&#x25CF;</td>
                <td id="0.4.5">&#x25CF;</td>
                <td id="0.4.6">&#x25CF;</td>
                <td id="0.4.7">&#x25CF;</td>
                <td id="0.4.8">&#x25CF;</td>
                <td id="0.4.9">&#x25CF;</td>
            </tr>
            <tr>
                <td id="0.5.0">&#x25CF;</td>
                <td id="0.5.1">&#x25CF;</td>
                <td id="0.5.2">&#x25CF;</td>
                <td id="0.5.3">&#x25CF;</td>
                <td id="0.5.4">&#x25CF;</td>
                <td id="0.5.5">&#x25CF;</td>
                <td id="0.5.6">&#x25CF;</td>
                <td id="0.5.7">&#x25CF;</td>
                <td id="0.5.8">&#x25CF;</td>
                <td id="0.5.9">&#x25CF;</td>
            </tr>
            <tr>
                <td id="0.6.0">&#x25CF;</td>
                <td id="0.6.1">&#x25CF;</td>
                <td id="0.6.2">&#x25CF;</td>
                <td id="0.6.3">&#x25CF;</td>
                <td id="0.6.4">&#x25CF;</td>
                <td id="0.6.5">&#x25CF;</td>
                <td id="0.6.6">&#x25CF;</td>
                <td id="0.6.7">&#x25CF;</td>
                <td id="0.6.8">&#x25CF;</td>
                <td id="0.6.9">&#x25CF;</td>
            </tr>
            <tr>
                <td id="0.7.0">&#x25CF;</td>
                <td id="0.7.1">&#x25CF;</td>
                <td id="0.7.2">&#x25CF;</td>
                <td id="0.7.3">&#x25CF;</td>
                <td id="0.7.4">&#x25CF;</td>
                <td id="0.7.5">&#x25CF;</td>
                <td id="0.7.6">&#x25CF;</td>
                <td id="0.7.7">&#x25CF;</td>
                <td id="0.7.8">&#x25CF;</td>
                <td id="0.7.9">&#x25CF;</td>
            </tr>
            <tr>
                <td id="0.8.0">&#x25CF;</td>
                <td id="0.8.1">&#x25CF;</td>
                <td id="0.8.2">&#x25CF;</td>
                <td id="0.8.3">&#x25CF;</td>
                <td id="0.8.4">&#x25CF;</td>
                <td id="0.8.5">&#x25CF;</td>
                <td id="0.8.6">&#x25CF;</td>
                <td id="0.8.7">&#x25CF;</td>
                <td id="0.8.8">&#x25CF;</td>
                <td id="0.8.9">&#x25CF;</td>
            </tr>
            <tr>
                <td id="0.9.0">&#x25CF;</td>
                <td id="0.9.1">&#x25CF;</td>
                <td id="0.9.2">&#x25CF;</td>
                <td id="0.9.3">&#x25CF;</td>
                <td id="0.9.4">&#x25CF;</td>
                <td id="0.9.5">&#x25CF;</td>
                <td id="0.9.6">&#x25CF;</td>
                <td id="0.9.7">&#x25CF;</td>
                <td id="0.9.8">&#x25CF;</td>
                <td id="0.9.9">&#x25CF;</td>
            </tr>
        </table>
    </div>
    <div class="field">
        <table>
            <tr>
                <td id="1.0.0">&#x25CF;</td>
                <td id="1.0.1">&#x25CF;</td>
                <td id="1.0.2">&#x25CF;</td>
                <td id="1.0.3">&#x25CF;</td>
                <td id="1.0.4">&#x25CF;</td>
                <td id="1.0.5">&#x25CF;</td>
                <td id="1.0.6">&#x25CF;</td>
                <td id="1.0.7">&#x25CF;</td>
                <td id="1.0.8">&#x25CF;</td>
                <td id="1.0.9">&#x25CF;</td>
            </tr>
            <tr>
                <td id="1.1.0">&#x25CF;</td>
                <td id="1.1.1">&#x25CF;</td>
                <td id="1.1.2">&#x25CF;</td>
                <td id="1.1.3">&#x25CF;</td>
                <td id="1.1.4">&#x25CF;</td>
                <td id="1.1.5">&#x25CF;</td>
                <td id="1.1.6">&#x25CF;</td>
                <td id="1.1.7">&#x25CF;</td>
                <td id="1.1.8">&#x25CF;</td>
                <td id="1.1.9">&#x25CF;</td>
            </tr>
            <tr>
                <td id="1.2.0">&#x25CF;</td>
                <td id="1.2.1">&#x25CF;</td>
                <td id="1.2.2">&#x25CF;</td>
                <td id="1.2.3">&#x25CF;</td>
                <td id="1.2.4">&#x25CF;</td>
                <td id="1.2.5">&#x25CF;</td>
                <td id="1.2.6">&#x25CF;</td>
                <td id="1.2.7">&#x25CF;</td>
                <td id="1.2.8">&#x25CF;</td>
                <td id="1.2.9">&#x25CF;</td>
            </tr>
            <tr>
                <td id="1.3.0">&#x25CF;</td>
                <td id="1.3.1">&#x25CF;</td>
                <td id="1.3.2">&#x25CF;</td>
                <td id="1.3.3">&#x25CF;</td>
                <td id="1.3.4">&#x25CF;</td>
                <td id="1.3.5">&#x25CF;</td>
                <td id="1.3.6">&#x25CF;</td>
                <td id="1.3.7">&#x25CF;</td>
                <td id="1.3.8">&#x25CF;</td>
                <td id="1.3.9">&#x25CF;</td>
            </tr>
            <tr>
                <td id="1.4.0">&#x25CF;</td>
                <td id="1.4.1">&#x25CF;</td>
                <td id="1.4.2">&#x25CF;</td>
                <td id="1.4.3">&#x25CF;</td>
                <td id="1.4.4">&#x25CF;</td>
                <td id="1.4.5">&#x25CF;</td>
                <td id="1.4.6">&#x25CF;</td>
                <td id="1.4.7">&#x25CF;</td>
                <td id="1.4.8">&#x25CF;</td>
                <td id="1.4.9">&#x25CF;</td>
            </tr>
            <tr>
                <td id="1.5.0">&#x25CF;</td>
                <td id="1.5.1">&#x25CF;</td>
                <td id="1.5.2">&#x25CF;</td>
                <td id="1.5.3">&#x25CF;</td>
                <td id="1.5.4">&#x25CF;</td>
                <td id="1.5.5">&#x25CF;</td>
                <td id="1.5.6">&#x25CF;</td>
                <td id="1.5.7">&#x25CF;</td>
                <td id="1.5.8">&#x25CF;</td>
                <td id="1.5.9">&#x25CF;</td>
            </tr>
            <tr>
                <td id="1.6.0">&#x25CF;</td>
                <td id="1.6.1">&#x25CF;</td>
                <td id="1.6.2">&#x25CF;</td>
                <td id="1.6.3">&#x25CF;</td>
                <td id="1.6.4">&#x25CF;</td>
                <td id="1.6.5">&#x25CF;</td>
                <td id="1.6.6">&#x25CF;</td>
                <td id="1.6.7">&#x25CF;</td>
                <td id="1.6.8">&#x25CF;</td>
                <td id="1.6.9">&#x25CF;</td>
            </tr>
            <tr>
                <td id="1.7.0">&#x25CF;</td>
                <td id="1.7.1">&#x25CF;</td>
                <td id="1.7.2">&#x25CF;</td>
                <td id="1.7.3">&#x25CF;</td>
                <td id="1.7.4">&#x25CF;</td>
                <td id="1.7.5">&#x25CF;</td>
                <td id="1.7.6">&#x25CF;</td>
                <td id="1.7.7">&#x25CF;</td>
                <td id="1.7.8">&#x25CF;</td>
                <td id="1.7.9">&#x25CF;</td>
            </tr>
            <tr>
                <td id="1.8.0">&#x25CF;</td>
                <td id="1.8.1">&#x25CF;</td>
                <td id="1.8.2">&#x25CF;</td>
                <td id="1.8.3">&#x25CF;</td>
                <td id="1.8.4">&#x25CF;</td>
                <td id="1.8.5">&#x25CF;</td>
                <td id="1.8.6">&#x25CF;</td>
                <td id="1.8.7">&#x25CF;</td>
                <td id="1.8.8">&#x25CF;</td>
                <td id="1.8.9">&#x25CF;</td>
            </tr>
            <tr>
                <td id="1.9.0">&#x25CF;</td>
                <td id="1.9.1">&#x25CF;</td>
                <td id="1.9.2">&#x25CF;</td>
                <td id="1.9.3">&#x25CF;</td>
                <td id="1.9.4">&#x25CF;</td>
                <td id="1.9.5">&#x25CF;</td>
                <td id="1.9.6">&#x25CF;</td>
                <td id="1.9.7">&#x25CF;</td>
                <td id="1.9.8">&#x25CF;</td>
                <td id="1.9.9">&#x25CF;</td>
            </tr>
        </table>
    </div>
</div>
</body>
</html>
